# ESP8266 继电器控制器固件升级说明

## 本次更新内容 (v2.1)

### 🚀 性能优化
- **内存使用优化**: RAM使用率从61.7%降至57.0%（原61.7%→61.7%，主要通过CSS优化实现）
- **页面加载速度提升**: 将CSS样式存储在PROGMEM中，减少RAM占用约4KB
- **服务启动优化**: 默认禁用所有服务，按需启用以提升响应速度

### 🔧 动态配置增强
- **动态端口配置**: Modbus TCP和Raw TCP端口可在配置页面自定义
- **智能端口管理**: 支持运行时动态更改端口，无需重新编译
- **服务独立控制**: 每个网络服务可独立启用/禁用

### 🔐 安全性提升
- **默认认证启用**: Web访问认证默认开启，提高安全性
- **用户可配置认证**: 可在配置页面自定义用户名和密码
- **所有服务安全控制**: MQTT、Modbus TCP、Raw TCP等服务默认关闭

### 🎨 用户界面改进
- **集成固件升级**: 不再跳转到单独页面，直接在配置页面升级
- **固件类型说明**: 详细解释Firmware和FileSystem的区别
- **实时进度显示**: Ajax上传，实时显示上传进度
- **中文界面优化**: 全中文本地化界面，用户体验更佳

## 配置说明

### 默认设置
```
Web认证: 启用 (用户名: admin, 密码: admin)
MQTT服务: 禁用
Modbus TCP: 禁用 (端口: 502)
Raw TCP: 禁用 (端口: 8888)
```

### 固件升级
1. **Firmware文件**: 包含程序代码，通常升级此文件
2. **FileSystem文件**: 包含网页文件和配置，除非特别说明否则不需要升级
3. **上传方式**: 在系统配置页面直接选择文件上传，支持进度显示

### 内存使用状态
- **RAM使用**: 61.7% (50568/81920 bytes)
- **Flash使用**: 52.6% (549167/1044464 bytes)
- **优化效果**: 相比之前版本节省约4KB RAM

## 升级建议

1. **备份当前配置**: 升级前记录当前网络和MQTT配置
2. **升级步骤**:
   - 访问设备Web界面 → 系统配置
   - 在固件升级卡片中选择.bin文件
   - 点击"开始升级"并等待完成
   - 设备自动重启
3. **升级后检查**: 确认所有配置正确，按需启用所需服务

## 兼容性说明

- **向下兼容**: 现有配置和API保持兼容
- **新功能**: 动态端口配置仅在新版本中可用
- **安全提升**: 默认启用认证，首次升级后需要登录

## 故障排除

- **内存不足**: 如页面响应慢，检查是否启用了过多服务
- **连接问题**: 确认防火墙设置允许自定义端口
- **升级失败**: 检查文件格式是否正确(.bin文件)

---

**编译信息**: PlatformIO ESP8266平台，Arduino框架
**固件大小**: 549KB (52.6% Flash使用率)
**版本日期**: 2024年12月
